---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import StylishHeading from "../components/StylishHeading.astro";
import PostsList from "../components/PostsList.astro";

const postEntries = (await getCollection("posts")).sort(
	(a, b) => b.data.datetime.getTime() - a.data.datetime.getTime(),
);

const postsGroupedByYear = new Map<number, typeof postEntries>();

for (const entry of postEntries) {
	const year = entry.data.datetime.getFullYear();

	if (!postsGroupedByYear.has(year)) {
		postsGroupedByYear.set(year, [entry]);
		continue;
	}

	postsGroupedByYear.get(year)!.push(entry);
}
---

<BaseLayout>
	<div class="mx-auto flex max-w-3xl flex-col gap-40">
		{
			Array.from(postsGroupedByYear).map(([year, entries]) => (
				<section class="relative">
					<StylishHeading tag="h2" text={year} />
					<PostsList {entries} />
				</section>
			))
		}
	</div>
</BaseLayout>
